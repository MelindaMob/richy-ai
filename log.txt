# LOGS DE DÃ‰BOGAGE - SAUVEGARDÃ‰S POUR RÃ‰FÃ‰RENCE FUTURE
# Date: $(date)
# Ces logs ont Ã©tÃ© supprimÃ©s du code mais conservÃ©s ici au cas oÃ¹ ils seraient nÃ©cessaires

## ============================================
## FICHIER: src/app/api/stripe/sync-subscription/route.ts
## ============================================

// Ligne 13
console.log('[sync-subscription] POST request received')

// Ligne 30-34
console.log('[sync-subscription] ðŸ”´ User authenticated:', {
  user_id: user.id,
  email: user.email,
  session_active: true
})

// Ligne 37
console.log('[sync-subscription] âš ï¸ Pas de session active, utilisation userId depuis body:', userIdFromBody)

// Ligne 39
console.error('[sync-subscription] âŒ No user found and no userId in body')

// Ligne 44
console.error('[sync-subscription] No user found')

// Ligne 57-61
console.log('[sync-subscription] ðŸ”´ Subscription existante dans DB:', subscription ? {
  plan_type: subscription.plan_type,
  status: subscription.status,
  stripe_subscription_id: subscription.stripe_subscription_id
} : 'aucune')

// Ligne 70
console.log(`[sync-subscription] Using customer_id from DB: ${customerId}`)

// Ligne 75
console.log(`[sync-subscription] No customer_id in DB, searching in Stripe for user ${finalUserId}`)

// Ligne 96
console.log(`[sync-subscription] Searching for customer with email: ${normalizedEmail}`)

// Ligne 103
console.log(`[sync-subscription] Found ${customersByEmail.data.length} customer(s) by email`)

// Ligne 108
console.log(`[sync-subscription] Found customer by email: ${customer.id}, created: ${new Date(customer.created * 1000).toISOString()}`)

// Ligne 114
console.log(`[sync-subscription] Customer not found by email, searching by metadata user_id`)

// Ligne 122
console.log(`[sync-subscription] Found customer by metadata user_id: ${customer.id}`)

// Ligne 142
console.log(`[sync-subscription] Found ${subscriptions.data.length} subscription(s) for customer ${customerId}`)

// Ligne 156
console.log(`[sync-subscription] Using active upgrade subscription: ${stripeSubscription.id}, status: ${stripeSubscription.status}`)

// Ligne 165
console.log(`[sync-subscription] Using most recent active subscription: ${stripeSubscription.id}, status: ${stripeSubscription.status}`)

// Ligne 169
console.log(`[sync-subscription] Using most recent subscription (may be canceled): ${stripeSubscription.id}, status: ${stripeSubscription.status}`)

// Ligne 179
console.log(`[sync-subscription] Retrieved subscription from DB: ${stripeSubscription.id}, status: ${stripeSubscription.status}`)

// Ligne 181
console.error(`[sync-subscription] Error retrieving subscription ${subscription.stripe_subscription_id}:`, error)

// Ligne 186
console.error(`[sync-subscription] No subscription found in Stripe for user ${finalUserId}`)

// Ligne 191
console.log('[sync-subscription] Subscription non trouvÃ©e mais customerId existe, mise Ã  jour profil:', customerId)

// Ligne 198
console.error('[sync-subscription] Erreur mise Ã  jour profil avec stripe_customer_id:', profileUpdateError)

// Ligne 200
console.log('[sync-subscription] âœ… Profil mis Ã  jour avec stripe_customer_id (subscription pas encore disponible)')

// Ligne 219 (fetch instrumentation)
fetch('http://127.0.0.1:7242/ingest/d8a9e4b4-cd70-4c3a-a316-bdd5da8b9474',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'sync-subscription:174',message:'H5/H6: Metadata sync-subscription',data:{planTypeFromMetadata,isUpgradeFromMetadata,hasTrialEnd,subscription_status:stripeSubscription.status,trial_end:stripeSubscription.trial_end},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'H5'})}).catch(()=>{});

// Ligne 231 (fetch instrumentation)
fetch('http://127.0.0.1:7242/ingest/d8a9e4b4-cd70-4c3a-a316-bdd5da8b9474',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'sync-subscription:183',message:'H5/H6: isPremium calculÃ©',data:{isPremium,isUpgradeFromMetadata,planTypeIsDirect:planTypeFromMetadata==='direct',condition3:!hasTrialEnd&&stripeSubscription.status==='active'&&planTypeFromMetadata!=='trial'},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'H5'})}).catch(()=>{});

// Ligne 234-236
console.log(`[sync-subscription] User: ${finalUserId}, Status: ${stripeSubscription.status}, Trial end: ${stripeSubscription.trial_end}`)
console.log(`[sync-subscription] Metadata - plan_type: ${planTypeFromMetadata}, is_upgrade: ${isUpgradeFromMetadata}`)
console.log(`[sync-subscription] Is Premium: ${isPremium}`)

// Ligne 246
console.log(`[sync-subscription] âœ… Plan type depuis metadata: ${finalPlanType}`)

// Ligne 251
console.log(`[sync-subscription] âš ï¸ plan_type manquant dans metadata, conservation du plan_type existant dans DB: ${finalPlanType}`)

// Ligne 255
console.log(`[sync-subscription] âš ï¸ plan_type manquant dans metadata, dÃ©duit depuis trial_end (futur): ${finalPlanType}`)

// Ligne 259
console.log(`[sync-subscription] âš ï¸ plan_type dÃ©duit depuis isPremium (dernier recours): ${finalPlanType}`)

// Ligne 263 (fetch instrumentation)
fetch('http://127.0.0.1:7242/ingest/d8a9e4b4-cd70-4c3a-a316-bdd5da8b9474',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'sync-subscription:203',message:'H5/H6: finalPlanType dÃ©terminÃ©',data:{finalPlanType,planTypeFromMetadata,isPremium},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'H5'})}).catch(()=>{});

// Ligne 266
console.log(`[sync-subscription] Plan type final: ${finalPlanType} (metadata: ${planTypeFromMetadata}, isPremium: ${isPremium})`)

// Ligne 270 (fetch instrumentation)
fetch('http://127.0.0.1:7242/ingest/d8a9e4b4-cd70-4c3a-a316-bdd5da8b9474',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'sync-subscription:217',message:'H5: subscriptionData avant insertion',data:{plan_type:finalPlanType,status:stripeSubscription.status},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'H5'})}).catch(()=>{});

// Ligne 304-305
console.log('[sync-subscription] ðŸ”´ AVANT UPSERT - subscriptionData:', JSON.stringify(subscriptionData, null, 2))
console.log('[sync-subscription] ðŸ”´ plan_type qui sera insÃ©rÃ©:', subscriptionData.plan_type)

// Ligne 309 (fetch instrumentation)
fetch('http://127.0.0.1:7242/ingest/d8a9e4b4-cd70-4c3a-a316-bdd5da8b9474',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'sync-subscription:304',message:'H1/H2/H3/H4: AVANT UPSERT - finalUserId et subscriptionData',data:{finalUserId,subscriptionData_user_id:subscriptionData.user_id,subscriptionData_plan_type:subscriptionData.plan_type,subscriptionData_status:subscriptionData.status},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'H1'})}).catch(()=>{});

// Ligne 321 (fetch instrumentation)
fetch('http://127.0.0.1:7242/ingest/d8a9e4b4-cd70-4c3a-a316-bdd5da8b9474',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'sync-subscription:312',message:'H1/H2/H3/H4: APRÃˆS UPSERT - RÃ©sultat',data:{upsertError:upsertError?.message,upsertedData_length:upsertedData?.length,upsertedData_user_id:upsertedData?.[0]?.user_id,upsertedData_plan_type:upsertedData?.[0]?.plan_type},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'H1'})}).catch(()=>{});

// Ligne 324-329
console.log('[sync-subscription] ðŸ”´ APRÃˆS UPSERT - DonnÃ©es retournÃ©es:', JSON.stringify(upsertedData, null, 2))
if (upsertedData && upsertedData.length > 0) {
  console.log('[sync-subscription] ðŸ”´ plan_type dans la DB aprÃ¨s upsert:', upsertedData[0]?.plan_type)
  console.log('[sync-subscription] ðŸ”´ user_id dans la DB aprÃ¨s upsert:', upsertedData[0]?.user_id)
} else {
  console.log('[sync-subscription] âš ï¸ Aucune donnÃ©e retournÃ©e par l\'upsert !')
}

// Ligne 333
console.error('[sync-subscription] âŒ Error upserting subscription:', upsertError)

// Ligne 335 (fetch instrumentation)
fetch('http://127.0.0.1:7242/ingest/d8a9e4b4-cd70-4c3a-a316-bdd5da8b9474',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'sync-subscription:323',message:'H1: UPSERT ERROR',data:{error:upsertError.message,code:upsertError.code,details:upsertError.details},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'H1'})}).catch(()=>{});

// Ligne 349 (fetch instrumentation)
fetch('http://127.0.0.1:7242/ingest/d8a9e4b4-cd70-4c3a-a316-bdd5da8b9474',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'sync-subscription:332',message:'H2/H3/H4: VÃ‰RIFICATION POST-UPSERT',data:{subscription_found:!!verifySubscription,verify_user_id:verifySubscription?.user_id,verify_plan_type:verifySubscription?.plan_type,verify_error:verifyError?.message,query_user_id:finalUserId},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'H2'})}).catch(()=>{});

// Ligne 352-358
console.log('[sync-subscription] ðŸ”´ VÃ‰RIFICATION POST-UPSERT:', {
  subscription_found: !!verifySubscription,
  plan_type: verifySubscription?.plan_type,
  user_id: verifySubscription?.user_id,
  verify_error: verifyError?.message,
  query_user_id: finalUserId
})

// Ligne 366
console.log('[sync-subscription] Mise Ã  jour profil avec stripe_customer_id:', stripeCustomerId)

// Ligne 373
console.error('[sync-subscription] Erreur mise Ã  jour profil avec stripe_customer_id:', profileUpdateError)

// Ligne 376
console.log('[sync-subscription] âœ… Profil mis Ã  jour avec stripe_customer_id')

// Ligne 392-393
console.error('[sync-subscription] Unhandled error:', error)
console.error('[sync-subscription] Error stack:', error.stack)


## ============================================
## FICHIER: src/app/api/stripe/create-checkout-session/route.ts
## ============================================

// Ligne 19
console.warn('[create-checkout-session] REGISTRATION_ENCRYPTION_KEY manquante ou trop courte, fallback en clair')

// Ligne 42 (fetch instrumentation)
fetch('http://127.0.0.1:7242/ingest/d8a9e4b4-cd70-4c3a-a316-bdd5da8b9474',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'create-checkout-session:39',message:'H1: priceType reÃ§u',data:{priceType,isUpgrade,hasPendingReg:!!pendingRegistration},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'H1'})}).catch(()=>{});

// Ligne 46-48
console.log('[create-checkout-session] === DÃ‰BUT ===')
console.log('[create-checkout-session] pendingRegistration:', pendingRegistration ? 'prÃ©sent' : 'absent', pendingRegistration)
console.log('[create-checkout-session] priceType:', priceType)

// Ligne 51
console.log('[create-checkout-session] existingUser:', existingUser ? `prÃ©sent (${existingUser.id}, ${existingUser.email})` : 'absent')

// Ligne 57-58
console.log('[create-checkout-session] isNewRegistration:', isNewRegistration, '(pendingRegistration prÃ©sent:', !!pendingRegistration, ')')
console.log('[create-checkout-session] pendingRegistration complet:', JSON.stringify(pendingRegistration, null, 2))

// Ligne 62-63
console.warn('[create-checkout-session] âš ï¸ Nouvelle inscription dÃ©tectÃ©e mais utilisateur connectÃ©:', existingUser.email)
console.warn('[create-checkout-session] âš ï¸ Email de la nouvelle inscription:', pendingRegistration?.email)

// Ligne 68
console.log('[create-checkout-session] âš ï¸ Ce n\'est PAS une nouvelle inscription, on ne va PAS insÃ©rer dans pending_registrations')

// Ligne 73
console.error('[create-checkout-session] NEXT_PUBLIC_APP_URL non dÃ©fini')

// Ligne 86 (fetch instrumentation)
fetch('http://127.0.0.1:7242/ingest/d8a9e4b4-cd70-4c3a-a316-bdd5da8b9474',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'create-checkout-session:78',message:'H2: finalPriceType calculÃ©',data:{finalPriceType,priceType,isUpgrade},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'H2'})}).catch(()=>{});

// Ligne 89
console.log('[create-checkout-session] finalPriceType dÃ©terminÃ©:', finalPriceType, '(priceType:', priceType, ', isUpgrade:', isUpgrade, ')')

// Ligne 92
console.log('[create-checkout-session] âœ… EntrÃ©e dans le bloc isNewRegistration')

// Ligne 101-108
console.log('[create-checkout-session] DonnÃ©es extraites:', {
  email: email || 'VIDE',
  emailLength: email?.length || 0,
  emailFromRegistration: registration.email || 'VIDE',
  password: password ? 'prÃ©sent' : 'absent',
  phoneNumber: phoneNumber ? 'prÃ©sent' : 'absent',
  phoneVerificationId: phoneVerificationId ? 'prÃ©sent' : 'absent'
})

// Ligne 111-116
console.error('[create-checkout-session] âŒ DonnÃ©es incomplÃ¨tes:', {
  email: !!email,
  password: !!password,
  phoneNumber: !!phoneNumber,
  phoneVerificationId: !!phoneVerificationId
})

// Ligne 130
console.log('[create-checkout-session] Email dÃ©jÃ  utilisÃ© dans profiles:', email)

// Ligne 144
console.error('[create-checkout-session] Erreur vÃ©rif email admin:', listError)

// Ligne 149
console.log('[create-checkout-session] Email dÃ©jÃ  utilisÃ© dans auth.users:', email)

// Ligne 180
console.warn('[create-checkout-session] Password stockÃ© en clair temporairement (clÃ© manquante)')

// Ligne 186
console.error('[create-checkout-session] âŒ encrypted est null/undefined aprÃ¨s fallback')

// Ligne 196-197
console.log('[create-checkout-session] ðŸš€ Tentative d\'insertion dans pending_registrations')
console.log('[create-checkout-session] password_hash Ã  insÃ©rer:', encrypted ? 'prÃ©sent (' + encrypted.length + ' chars)' : 'VIDE')

// Ligne 217-226
console.log('[create-checkout-session] ðŸ“¦ DonnÃ©es Ã  insÃ©rer dans pending_registrations:', {
  token: registrationToken,
  email: email,
  hasPasswordHash: !!insertData.password_hash,
  passwordHashLength: insertData.password_hash?.length || 0,
  phone_number: phoneNumber,
  phone_verification_id: phoneVerificationId,
  plan_type: insertData.plan_type,
  expires_at: insertData.expires_at
})

// Ligne 234-241
console.error('[create-checkout-session] âŒ Erreur insert pending_registrations:', pendingError)
console.error('[create-checkout-session] DÃ©tails erreur complÃ¨te:', JSON.stringify({
  message: pendingError.message,
  details: pendingError.details,
  hint: pendingError.hint,
  code: pendingError.code
}, null, 2))
console.error('[create-checkout-session] DonnÃ©es qui ont causÃ© l\'erreur:', JSON.stringify(insertData, null, 2))

// Ligne 249
console.error('[create-checkout-session] âŒ Insertion rÃ©ussie mais aucune donnÃ©e retournÃ©e')

// Ligne 255-256
console.log('[create-checkout-session] âœ… Insertion rÃ©ussie dans pending_registrations:', pendingData)
console.log('[create-checkout-session] âœ… ID de l\'entrÃ©e crÃ©Ã©e:', pendingData[0]?.id)

// Ligne 259
console.log('[create-checkout-session] ðŸ” VÃ©rification customer Stripe existant pour:', email)

// Ligne 265
console.log('[create-checkout-session] Customers Stripe trouvÃ©s avec cet email:', existingCustomers.data.length)

// Ligne 268-274
existingCustomers.data.forEach((c, idx) => {
  console.log(`[create-checkout-session] Customer ${idx + 1}:`, {
    id: c.id,
    email: c.email,
    created: new Date(c.created * 1000).toISOString(),
    metadata: c.metadata
  })
})

// Ligne 278-279
console.log('[create-checkout-session] ðŸš€ CrÃ©ation client Stripe pour pending_registration')
console.log('[create-checkout-session] Email utilisÃ© pour customer Stripe:', email)

// Ligne 288-293
console.log('[create-checkout-session] âœ… Client Stripe crÃ©Ã©:', {
  customerId,
  email: customer.email,
  emailMatch: customer.email === email ? 'âœ… MATCH' : 'âŒ DIFFÃ‰RENT',
  created: new Date(customer.created * 1000).toISOString()
})

// Ligne 295
console.log('[create-checkout-session] âš ï¸ isNewRegistration est false, utilisation du flux utilisateur existant')

// Ligne 317
console.log('[create-checkout-session] Annulation de l\'ancienne subscription:', existingSub.stripe_subscription_id)

// Ligne 322
console.log('[create-checkout-session] âœ… Ancienne subscription annulÃ©e')

// Ligne 324
console.log('[create-checkout-session] âš ï¸ Ancienne subscription dÃ©jÃ  annulÃ©e ou inexistante, on continue')

// Ligne 329
console.log('[create-checkout-session] âš ï¸ Ancienne subscription n\'existe plus dans Stripe, on continue:', existingSub.stripe_subscription_id)

// Ligne 331
console.error('[create-checkout-session] âŒ Erreur lors de l\'annulation de l\'ancienne subscription:', cancelError)

// Ligne 340
console.log('[create-checkout-session] CrÃ©ation du client Stripe pour user:', user.id)

// Ligne 359
console.log('[create-checkout-session] Mise Ã  jour profil avec stripe_customer_id pour upgrade:', customerId)

// Ligne 375
console.log('[create-checkout-session] VÃ©rification profil avec stripe_customer_id pour upgrade:', customerId)

// Ligne 383
console.log('[create-checkout-session] Mise Ã  jour profil avec stripe_customer_id (manquant):', customerId)

// Ligne 389
console.log(`[create-checkout-session] Customer ${customerId} not found in Stripe, creating new one`)

// Ligne 406
console.log('[create-checkout-session] Mise Ã  jour profil avec nouveau stripe_customer_id pour upgrade:', customerId)

// Ligne 419
console.error('[create-checkout-session] STRIPE_PRICE_DIRECT_ID non dÃ©fini')

// Ligne 429-433
console.log('[create-checkout-session] ðŸ” Customer vÃ©rifiÃ© avant session:', {
  id: customerCheck.id,
  email: (customerCheck as Stripe.Customer).email,
  deleted: (customerCheck as Stripe.Customer).deleted || false
})

// Ligne 435
console.error('[create-checkout-session] Erreur vÃ©rification customer:', err)

// Ligne 440
console.log('[create-checkout-session] ðŸš€ CrÃ©ation session checkout avec customerId:', customerId)

// Ligne 450-453
console.log('[create-checkout-session] ðŸ“§ Mise Ã  jour email du customer:', {
  ancien: currentCustomer.email,
  nouveau: correctEmail
})

// Ligne 458
console.log('[create-checkout-session] âœ… Email du customer mis Ã  jour')

// Ligne 460
console.log('[create-checkout-session] âœ… Email du customer dÃ©jÃ  correct')

// Ligne 463
console.error('[create-checkout-session] âŒ Erreur mise Ã  jour email customer:', updateError)

// Ligne 504 (fetch instrumentation)
fetch('http://127.0.0.1:7242/ingest/d8a9e4b4-cd70-4c3a-a316-bdd5da8b9474',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'create-checkout-session:492',message:'H3: Metadata Stripe dÃ©finies',data:{subscription_metadata_plan_type:finalPriceType,session_metadata_plan_type:finalPriceType,trial_period_days:finalPriceType==='trial'&&!isUpgrade?3:undefined},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'H3'})}).catch(()=>{});

// Ligne 507-519
console.log('[create-checkout-session] ðŸ“‹ Metadata Stripe dÃ©finies:', {
  subscription_metadata: {
    plan_type: finalPriceType,
    is_upgrade: isUpgrade.toString(),
    has_user_id: !!user?.id,
    has_registration_token: !!registrationToken
  },
  session_metadata: {
    plan_type: finalPriceType,
    has_registration_token: !!registrationToken
  },
  trial_period_days: finalPriceType === 'trial' && !isUpgrade ? 3 : undefined
})

// Ligne 528
console.error('[create-checkout-session] Erreur rÃ©cupÃ©ration customer depuis session:', err)

// Ligne 532-533
console.log(`[create-checkout-session] Session created: ${session.id}, plan_type: ${finalPriceType}, is_upgrade: ${isUpgrade}, registration_token: ${registrationToken}`)
console.log(`[create-checkout-session] Email dans session customer: ${sessionCustomerEmail}`)

// Ligne 540-547
console.error('[create-checkout-session] âŒ ERREUR COMPLÃˆTE:', {
  message: error?.message,
  stack: error?.stack,
  code: error?.code,
  statusCode: error?.statusCode,
  type: error?.type,
  raw: error
})


## ============================================
## FICHIER: src/app/(dashboard)/dashboard/payment-success/page.tsx
## ============================================

// Ligne 20
console.log('[payment-success] ðŸš€ DÃ©but crÃ©ation compte et synchronisation')

// Ligne 28
console.log('[payment-success] VÃ©rification du type de paiement pour session:', sessionId)

// Ligne 36
console.log('[payment-success] Nouvelle inscription dÃ©tectÃ©e, crÃ©ation du compte')

// Ligne 44
console.log('[payment-success] RÃ©ponse create-account-from-session:', createAccountData)

// Ligne 47
console.log('[payment-success] âœ… Compte crÃ©Ã© ou existe dÃ©jÃ :', createAccountData.userId)

// Ligne 50
console.log('[payment-success] Utilisateur existe dÃ©jÃ , synchronisation subscription puis redirection')

// Ligne 54
console.log('[payment-success] Upgrade dÃ©tectÃ©, pas de crÃ©ation de compte nÃ©cessaire')

// Ligne 60
console.log('[payment-success] ðŸ”„ Synchronisation de la subscription AVANT redirection')

// Ligne 69
console.log(`[payment-success] Tentative de synchronisation ${attempt}/2`)

// Ligne 80
console.log('[payment-success] âœ… Subscription synced:', data)

// Ligne 86
console.warn(`[payment-success] âš ï¸ Route non trouvÃ©e (404), le webhook crÃ©era la subscription`)

// Ligne 89
console.warn(`[payment-success] âš ï¸ Erreur HTTP ${response.status} lors de la synchronisation`)

// Ligne 92
console.warn(`[payment-success] âš ï¸ Erreur lors de la tentative ${attempt}:`, error)

// Ligne 103
console.log('[payment-success] â³ Synchronisation non rÃ©ussie, attente 2 secondes pour le webhook...')

// Ligne 111
console.log('[payment-success] Connexion automatique via lien magique aprÃ¨s sync')

// Ligne 120
console.log('[payment-success] Redirection vers callback avec magic link')

// Ligne 125
console.error('[payment-success] Erreur parsing lien magique:', e)

// Ligne 130
console.log('[payment-success] Redirection vers magic link (fallback)')

// Ligne 136
console.log('[payment-success] Pas de lien magique, redirection vers login')

// Ligne 144
console.log('[payment-success] âœ… Synchronisation rÃ©ussie, attente 1.5 secondes puis redirection')

// Ligne 146
console.log('[payment-success] Redirection vers dashboard')

// Ligne 150
console.error('[payment-success] âŒ Synchronisation Ã©chouÃ©e:', data)

// Ligne 152
console.log('[payment-success] Attente 3 secondes au cas oÃ¹ le webhook arrive...')

// Ligne 154
console.log('[payment-success] Redirection vers dashboard (mÃªme si sync Ã©chouÃ©e)')

// Ligne 159
console.error('[payment-success] Error:', error)

// Ligne 162
console.log('[payment-success] Erreur capturÃ©e, attente 3 secondes puis redirection')


## ============================================
## FICHIER: src/app/(dashboard)/dashboard/page.tsx
## ============================================

// Ligne 15-18
console.log('ðŸ”´ [DASHBOARD SERVER] User auth:', user ? {
  id: user.id,
  email: user.email
} : 'NO USER')

// Ligne 33-38
console.log('ðŸ”´ [DASHBOARD SERVER] Profile:', profile ? {
  id: profile.id,
  email: profile.email,
  subscription_status: profile.subscription_status,
  stripe_customer_id: profile.stripe_customer_id
} : 'NO PROFILE')

// Ligne 49 (fetch instrumentation)
fetch('http://127.0.0.1:7242/ingest/d8a9e4b4-cd70-4c3a-a316-bdd5da8b9474',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'dashboard:45',message:'H2/H3/H4: DASHBOARD - Query subscription',data:{dashboard_user_id:user.id,subscription_found:!!subscription,subscription_user_id:subscription?.user_id,subscription_plan_type:subscription?.plan_type,subscription_error:subscriptionError?.message},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'H2'})}).catch(()=>{});

// Ligne 52-63
console.log('ðŸ”´ [DASHBOARD SERVER] Subscription query:', {
  user_id: user.id,
  subscription_found: !!subscription,
  subscription_error: subscriptionError?.message,
  subscription_data: subscription ? {
    id: subscription.id,
    plan_type: subscription.plan_type,
    status: subscription.status,
    stripe_subscription_id: subscription.stripe_subscription_id,
    user_id: subscription.user_id
  } : null
})

// Ligne 66-75
console.log('ðŸ”´ [DASHBOARD] Subscription data from DB:', JSON.stringify({
  subscription_id: subscription?.id,
  plan_type: subscription?.plan_type,
  status: subscription?.status,
  trial_ends_at: subscription?.trial_ends_at,
  trial_limitations: subscription?.trial_limitations,
  stripe_subscription_id: subscription?.stripe_subscription_id,
  stripe_customer_id: subscription?.stripe_customer_id,
  created_at: subscription?.created_at
}, null, 2))

// Ligne 141-148
console.log('ðŸ”´ [DASHBOARD] Final computed values:', JSON.stringify({
  isTrialPlan,
  isCurrentlyTrial,
  hasTrialLimitations,
  subscriptionStatus,
  trialDaysLeft,
  profile_subscription_status: profile?.subscription_status
}, null, 2))


## ============================================
## FICHIER: src/components/DashboardDebugLogs.tsx
## ============================================

// Tous les console.log, console.error, console.warn dans ce fichier sont des logs de dÃ©bogage
// Le composant entier est un composant de dÃ©bogage qui affiche des logs dans la console
// Voir le fichier complet pour tous les logs


## ============================================
## FICHIER: src/app/api/stripe/webhook/route.ts
## ============================================

// Ligne 87-88 (fetch instrumentation)
fetch('http://127.0.0.1:7242/ingest/d8a9e4b4-cd70-4c3a-a316-bdd5da8b9474',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'webhook:87',message:'H4: Metadata webhook reÃ§ues',data:{subscription_metadata:subscription.metadata,session_metadata:session.metadata,subscription_plan_type:subscription.metadata?.plan_type},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'H4'})}).catch(()=>{});

// Ligne 102-103 (fetch instrumentation)
fetch('http://127.0.0.1:7242/ingest/d8a9e4b4-cd70-4c3a-a316-bdd5da8b9474',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'webhook:96',message:'H4: planType dÃ©duit depuis trial_end',data:{planType,hasTrialEnd,trial_end:subscription.trial_end},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'H4'})}).catch(()=>{});

// Ligne 107-108 (fetch instrumentation)
fetch('http://127.0.0.1:7242/ingest/d8a9e4b4-cd70-4c3a-a316-bdd5da8b9474',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({location:'webhook:98',message:'H4: planType final webhook',data:{planType,subscription_status:subscription.status},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'H4'})}).catch(()=>{});

